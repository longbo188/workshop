<ion-header>
  <ion-toolbar>
    <ion-title>车间报工系统</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="login-container" fullscreen="true">
  <!-- 背景层 -->
  <div class="login-bg">
    <div class="bg-gradient"></div>
    <div class="bg-grid"></div>
  </div>

  <!-- 居中布局容器 -->
  <div class="login-wrapper">
    <div class="login-card">
      <!-- 装饰线条 -->
      <div class="corner-decor corner-decor--tl"></div>
      <div class="corner-decor corner-decor--br"></div>

      <!-- 标题区 -->
      <div class="login-header">
        <h1>用户登录</h1>
        <p>请使用您的账号登录车间报工系统</p>
      </div>

      <!-- 表单区 -->
      <div class="login-form">
        <!-- 用户名 -->
        <div class="input-group">
          <div class="input-icon">
            <ion-icon name="person-outline"></ion-icon>
          </div>
          <ion-input
            type="text"
            [(ngModel)]="username"
            [disabled]="isLoading"
            placeholder="用户名"
            name="username"
            class="input-field">
          </ion-input>
        </div>

        <!-- 密码 -->
        <div class="input-group">
          <div class="input-icon">
            <ion-icon name="lock-closed-outline"></ion-icon>
          </div>
          <ion-input
            type="password"
            [(ngModel)]="password"
            [disabled]="isLoading"
            placeholder="密码"
            name="password"
            class="input-field">
          </ion-input>
        </div>

        <!-- 记住密码 + 修改密码 -->
        <div class="remember-row">
          <div class="remember-left">
            <ion-checkbox [(ngModel)]="rememberMe" name="rememberMe"></ion-checkbox>
            <label>记住密码</label>
          </div>
          <div class="remember-right">
            <button type="button" (click)="openChangePasswordModal()" [disabled]="isLoading">
              修改密码
            </button>
          </div>
        </div>

        <!-- 错误信息 -->
        <div class="error-message" *ngIf="errorMessage">
          <ion-icon name="warning-outline"></ion-icon>
          <span>{{ errorMessage }}</span>
        </div>

        <!-- 登录按钮 -->
        <ion-button
          expand="block"
          [disabled]="isLoading"
          (click)="login()"
          class="login-button">
          <ion-spinner *ngIf="isLoading" name="crescent"></ion-spinner>
          <span *ngIf="!isLoading">登录</span>
        </ion-button>

      </div>

      <!-- 页脚小提示 -->
      <div class="login-footer">
        <p>建议使用 Chrome 浏览器，获得最佳体验</p>
      </div>
    </div>
  </div>
</ion-content>

<!-- 修改密码弹窗（使用 IonModal） -->
<ion-modal [isOpen]="isChangePasswordModalOpen" (didDismiss)="closeChangePasswordModal()">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>修改密码</ion-title>
        <ion-buttons slot="end">
          <ion-button color="dark" style="color: #111827;" (click)="closeChangePasswordModal()">关闭</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    <ion-content class="ion-padding">
      <ion-item>
        <ion-label position="stacked">用户名</ion-label>
        <ion-input
          type="text"
          [(ngModel)]="username"
          [disabled]="isLoading"
          placeholder="用户名">
        </ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">原密码</ion-label>
        <ion-input
          type="password"
          [(ngModel)]="oldPassword"
          [disabled]="isLoading"
          placeholder="原密码">
        </ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">新密码</ion-label>
        <ion-input
          type="password"
          [(ngModel)]="newPassword"
          [disabled]="isLoading"
          placeholder="新密码（至少6位）">
        </ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">确认新密码</ion-label>
        <ion-input
          type="password"
          [(ngModel)]="confirmPassword"
          [disabled]="isLoading"
          placeholder="确认新密码">
        </ion-input>
      </ion-item>

      <div class="error-message" *ngIf="changePasswordMessage" style="margin-top: 12px; color: #111827;">
        <ion-icon name="information-circle-outline"></ion-icon>
        <span>{{ changePasswordMessage }}</span>
      </div>

      <div class="remember-row" style="margin-top: 16px;">
        <button type="button" (click)="closeChangePasswordModal()" [disabled]="isLoading">
          取消
        </button>
        <button type="button" (click)="changePassword()" [disabled]="isLoading">
          确认修改
        </button>
      </div>
    </ion-content>
  </ng-template>
</ion-modal>