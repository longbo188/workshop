# 任务导入功能使用说明

## 功能概述
为管理员和主管添加了Excel任务导入功能，支持从Excel文件中批量导入生产任务。

## Excel文件格式要求

### 必需列
- **C列（第3列）**：设备号（必填）
- **F列（第6列）**：产品型号（必填）

### 可选列
- **E列（第5列）**：是否非标（可选，填写"是"或"否"）
- **Q列（第17列）**：投产时间（可选）
- **O列（第15列）**：承诺完成时间（可选）
- **V列（第22列）**：订单状态（可选）
- **AL列（第38列）**：紧急程度（可选，填写"紧急"或"非紧急"）

### 示例数据格式
| A | B | C | D | E | F | G | ... | O | ... | Q | ... | V | ... | AL |
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
| 序号 | 项目 | 设备号 | 描述 | 是否非标 | 产品型号 | 规格 | ... | 承诺完成时间 | ... | 投产时间 | ... | 订单状态 | ... | 紧急程度 |
| 1 | 项目A | DEV001 | 设备描述 | 是 | MODEL-X1 | 规格1 | ... | 2024-01-20 | ... | 2024-01-15 | ... | 未开工 | ... | 紧急 |
| 2 | 项目B | DEV002 | 设备描述 | 否 | MODEL-Y2 | 规格2 | ... | 2024-01-25 | ... | 2024-01-20 | ... | 进行中 | ... | 非紧急 |

## 优先级判断规则

系统会根据以下规则设置任务优先级：

1. **AL列优先级**：如果AL列提供了"紧急"或"非紧急"，则直接使用该值
2. **默认值**：如果AL列未提供，则默认为"非紧急"

## 是否非标字段

- **E列**：填写"是"表示非标任务，填写"否"或留空表示标准任务
- 系统会自动将"是"转换为1，"否"或其他值转换为0，并存储到数据库的 `is_non_standard` 字段中

## 使用步骤

1. 登录系统（管理员或主管账号）
2. 进入"主管派工"页面
3. 点击右上角"导入任务"按钮
4. 选择Excel文件（.xlsx或.xls格式）
5. 点击"开始导入"
6. 查看导入结果

## 权限要求

- 只有管理员（admin）和主管（supervisor）可以访问导入功能
- 工人（worker）无法看到导入按钮

## 错误处理

系统会显示详细的错误信息，包括：
- 文件格式错误
- 必填字段缺失
- 日期格式不正确
- 数据验证失败

## 数据库更新

运行以下迁移脚本更新数据库结构：

1. **添加基础字段**（如果尚未运行）：
```bash
mysql -u root -p < database_migration_add_task_fields.sql
```

2. **添加是否非标字段**：
```bash
node migrate_add_is_non_standard.js
```

## 技术实现

- 后端使用 `xlsx` 库解析Excel文件
- 使用 `multer` 处理文件上传
- 前端使用Ionic模态框提供用户界面
- 支持批量插入和错误报告























